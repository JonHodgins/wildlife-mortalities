@using WildlifeMortalities.Data.Entities
@using WildlifeMortalities.Shared.Services
<MudTextField @bind-Value="ViewModel.Landmark" For="@(() => ViewModel.Landmark)" Label="Landmark"/>
<MudAutocomplete T="GameManagementArea" Label="Game Management Area" @bind-Value="ViewModel.GameManagementArea" SearchFunc="SearchGameManagementAreas"
                 ToStringFunc="@(x => x == null ? string.Empty : x.Area)" MaxItems="null" Placeholder="Select a GMA" For="@(() => ViewModel.GameManagementArea)"/>

@code {
    private IEnumerable<GameManagementArea> _gameManagementAreas = Array.Empty<GameManagementArea>();

    [Parameter]
    [EditorRequired]
    public HuntedActivityViewModel ViewModel { get; set; } = null!;

    [Inject]
    public IMortalityService MortalityService { get; set; } = null!;


    protected override async Task OnInitializedAsync()
    {
        _gameManagementAreas = await MortalityService.GetGameManagementAreas();
    }

    private async Task<IEnumerable<GameManagementArea>> SearchGameManagementAreas(string value)
    {
        if (string.IsNullOrEmpty(value))
            return _gameManagementAreas;
        return await Task.FromResult(_gameManagementAreas.Where(y => y.Area.StartsWith(value) || (y.Zone + y.Subzone).StartsWith(value)));
    }

}
